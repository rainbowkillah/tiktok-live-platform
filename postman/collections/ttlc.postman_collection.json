{
  "info": {
    "_postman_id": "72967a11-2a8d-4aae-810e-2325c81ae3a0",
    "name": "TikTok LIVE Platform â€” TTLC API",
    "description": "Complete API test collection for the TikTok LIVE Platform. Covers all public endpoints: Health, Events (SSE + historical), Sessions (replay), Rules (CRUD), and Storage queries.\n\nOwner Agent: Copilot (QA, CI/CD & Developer Experience Lead)\nDepends on: docs/architecture.md, docs/contracts/unified-event.v1.schema.json\nGitHub Issue: #17\n\nEnvironment variables required:\n- base_url: API base URL (e.g. http://localhost:3000)\n- stream_id: Test stream ID (e.g. 7123456789)\n- session_id: Test session ID (e.g. 550e8400-e29b-41d4-a716-446655440001)\n- rule_id: Rule UUID (populated by 'Create Rule' request)\n- session_token: Bearer token for authenticated endpoints (optional in dev)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "GET Health Check",
          "id": "health-001",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Returns server health status including uptime and active connections."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has status field', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        }
      ],
      "id": "82f84378-5e5a-4539-86ba-d8c5215911f8",
      "description": "Health and readiness checks for the platform."
    },
    {
      "name": "Events",
      "item": [
        {
          "name": "GET Stream Events (SSE)",
          "id": "events-001",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "text/event-stream",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/streams/{{stream_id}}/events",
              "host": ["{{base_url}}"],
              "path": ["streams", "{{stream_id}}", "events"]
            },
            "description": "Server-Sent Events (SSE) live feed for a specific stream. Returns UnifiedEvent v1 objects in real-time.\n\nNote: Postman has limited SSE support. For full testing, use:\n```bash\ncurl -N {{base_url}}/streams/{{stream_id}}/events\n```"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Content-Type is text/event-stream', function () {",
                  "    pm.response.to.have.header('Content-Type');",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/event-stream');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        }
      ],
      "id": "f1ee9627-d4b1-4f27-b216-8a8df1809229",
      "description": "Live SSE feed and historical event queries. Stream events are UnifiedEvent v1 objects validated against docs/contracts/unified-event.v1.schema.json."
    },
    {
      "name": "Sessions",
      "item": [
        {
          "name": "GET Session Events",
          "id": "sessions-001",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/sessions/{{session_id}}/events",
              "host": ["{{base_url}}"],
              "path": ["sessions", "{{session_id}}", "events"]
            },
            "description": "Query historical events for a specific session. Returns an array of UnifiedEvent v1 objects."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Events have required UnifiedEvent fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.length > 0) {",
                  "        const event = jsonData[0];",
                  "        pm.expect(event).to.have.property('schemaVersion');",
                  "        pm.expect(event).to.have.property('eventId');",
                  "        pm.expect(event).to.have.property('eventType');",
                  "        pm.expect(event).to.have.property('streamId');",
                  "        pm.expect(event).to.have.property('sessionId');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        },
        {
          "name": "POST Replay Session",
          "id": "sessions-002",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sessionId\": \"{{session_id}}\",\n  \"speed\": 1.0\n}"
            },
            "url": {
              "raw": "{{base_url}}/sessions/{{session_id}}/replay",
              "host": ["{{base_url}}"],
              "path": ["sessions", "{{session_id}}", "replay"]
            },
            "description": "Trigger replay of a recorded session. The session's events will be re-emitted through the event bus at the specified speed multiplier."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 202', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 202]);",
                  "});",
                  "",
                  "pm.test('Response has replay confirmation', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('sessionId');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        }
      ],
      "id": "e4b62214-c195-46eb-82fc-ff1a5e87dfa5",
      "description": "Session management and replay controls."
    },
    {
      "name": "Rules",
      "item": [
        {
          "name": "GET List Rules",
          "id": "rules-001",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/rules",
              "host": ["{{base_url}}"],
              "path": ["rules"]
            },
            "description": "List all rules configured for the rule engine."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        },
        {
          "name": "POST Create Rule",
          "id": "rules-002",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Gift Announcement\",\n  \"enabled\": true,\n  \"conditions\": {\n    \"eventType\": \"GIFT\",\n    \"minCoins\": 100\n  },\n  \"actions\": [\n    {\n      \"type\": \"overlay\",\n      \"template\": \"Thank you {username} for the {giftName} x{giftCount}!\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/rules",
              "host": ["{{base_url}}"],
              "path": ["rules"]
            },
            "description": "Create a new rule. Uses placeholder tokens like {username}, {displayName}, {giftName}, {giftCount}, {coins}, {message}."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has rule ID', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    ",
                  "    // Auto-populate rule_id variable for subsequent requests",
                  "    pm.collectionVariables.set('rule_id', jsonData.id);",
                  "});",
                  "",
                  "pm.test('Rule has required fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('name');",
                  "    pm.expect(jsonData).to.have.property('enabled');",
                  "    pm.expect(jsonData).to.have.property('conditions');",
                  "    pm.expect(jsonData).to.have.property('actions');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        },
        {
          "name": "PUT Update Rule",
          "id": "rules-003",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Gift Announcement (Updated)\",\n  \"enabled\": true,\n  \"conditions\": {\n    \"eventType\": \"GIFT\",\n    \"minCoins\": 200\n  },\n  \"actions\": [\n    {\n      \"type\": \"overlay\",\n      \"template\": \"WOW! {username} sent {giftName} x{giftCount}! ({coins} coins)\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/rules/{{rule_id}}",
              "host": ["{{base_url}}"],
              "path": ["rules", "{{rule_id}}"]
            },
            "description": "Update an existing rule by ID. The rule_id variable is auto-populated by the Create Rule request."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has updated rule', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData.id).to.equal(pm.collectionVariables.get('rule_id'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        },
        {
          "name": "DELETE Delete Rule",
          "id": "rules-004",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/rules/{{rule_id}}",
              "host": ["{{base_url}}"],
              "path": ["rules", "{{rule_id}}"]
            },
            "description": "Delete a rule by ID. The rule_id variable is auto-populated by the Create Rule request."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 204 or 200', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        },
        {
          "name": "POST Test Rule",
          "id": "rules-005",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ruleId\": \"{{rule_id}}\",\n  \"event\": {\n    \"schemaVersion\": \"1\",\n    \"eventId\": \"b4f2c3d5e6b7890123456789012345678901bcdef2345678901bcdef23456789\",\n    \"eventType\": \"GIFT\",\n    \"triggerId\": 2,\n    \"streamId\": \"7123456789\",\n    \"sessionId\": \"550e8400-e29b-41d4-a716-446655440001\",\n    \"timestamp\": \"2024-06-01T12:01:00.000Z\",\n    \"ingestedAt\": \"2024-06-01T12:01:00.050Z\",\n    \"source\": \"live\",\n    \"seqNo\": 1,\n    \"user\": {\n      \"userId\": \"1002\",\n      \"uniqueId\": \"testuser\",\n      \"displayName\": \"Test User\"\n    },\n    \"payload\": {\n      \"giftId\": 5655,\n      \"giftName\": \"Rose\",\n      \"giftCount\": 10,\n      \"coins\": 100\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/rules/test",
              "host": ["{{base_url}}"],
              "path": ["rules", "test"]
            },
            "description": "Test a rule against a sample UnifiedEvent without saving changes. Contract supports either `{ ruleId, event }` or `{ condition, event }` payloads and returns `{ matched, renderedTemplate, errors }`."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has matched field', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('matched');",
                  "});",
                  "",
                  "pm.test('Response has renderedTemplate field', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('renderedTemplate');",
                  "    pm.expect(jsonData.renderedTemplate === null || typeof jsonData.renderedTemplate === 'string').to.be.true;",
                  "});",
                  "",
                  "pm.test('Response has errors array field', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('errors');",
                  "    pm.expect(Array.isArray(jsonData.errors)).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        }
      ],
      "id": "bf61ca78-3ee8-4c98-87c0-4b5930ff5c55",
      "description": "CRUD operations for the rule engine. Rules define conditions on UnifiedEvents and actions (overlay, webhook, log) to trigger when conditions are met."
    },
    {
      "name": "Storage",
      "item": [],
      "id": "268be5b1-9112-4965-855b-3ce42934b6e3",
      "description": "Direct storage queries for streams and users. These endpoints expose data from the Postgres `streams` and `users` tables."
    }
  ],
  "variable": [
    {
      "id": "f815c83d-b238-42c7-9cc3-ac21e8ccebf8",
      "key": "base_url",
      "value": "http://localhost:3000",
      "description": "API base URL. Override per environment."
    },
    {
      "id": "2e7bda14-d4eb-4a54-8e23-876bd677bd47",
      "key": "stream_id",
      "value": "7123456789",
      "description": "Test stream ID (reserved for testing)."
    },
    {
      "id": "82ef72dd-77d5-43d7-8700-d0290c10454f",
      "key": "session_id",
      "value": "550e8400-e29b-41d4-a716-446655440001",
      "description": "Test session ID (reserved for testing)."
    },
    {
      "id": "d83a281f-bf50-4b04-b6f9-13348da24eee",
      "key": "rule_id",
      "value": "",
      "description": "Auto-populated by the 'Create Rule' request test script."
    }
  ]
}
