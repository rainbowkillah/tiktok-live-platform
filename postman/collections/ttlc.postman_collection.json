{
  "info": {
    "name": "TikTok LIVE Platform — TTLC API",
    "description": "Complete API test collection for the TikTok LIVE Platform. Covers all public endpoints: Health, Events (SSE + historical), Sessions (replay), Rules (CRUD), and Storage queries.\n\nOwner Agent: Copilot (QA, CI/CD & Developer Experience Lead)\nDepends on: docs/architecture.md, docs/contracts/unified-event.v1.schema.json\nGitHub Issue: #7\n\nEnvironment variables required:\n- base_url: API base URL (e.g. http://localhost:3000)\n- stream_id: Test stream ID (e.g. 7123456789)\n- session_id: Test session ID (e.g. 550e8400-e29b-41d4-a716-446655440001)\n- rule_id: Rule UUID (populated by 'Create Rule' request)\n- session_token: Bearer token for authenticated endpoints (optional in dev)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "description": "API base URL. Override per environment."
    },
    {
      "key": "stream_id",
      "value": "7123456789",
      "description": "Test stream ID (reserved for testing)."
    },
    {
      "key": "session_id",
      "value": "550e8400-e29b-41d4-a716-446655440001",
      "description": "Test session ID (reserved for testing)."
    },
    {
      "key": "rule_id",
      "value": "",
      "description": "Auto-populated by the 'Create Rule' request test script."
    }
  ],
  "item": [
    {
      "name": "Health",
      "description": "Health and readiness checks for the platform.",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/health",
            "description": "Returns a 200 OK with service status when all dependencies (Redis, Postgres) are reachable. Returns 503 when a critical dependency is unavailable."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200 OK', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has status field', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('status');",
                  "    pm.expect(json.status).to.be.oneOf(['ok', 'degraded']);",
                  "});",
                  "",
                  "pm.test('Response time is under 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — Healthy",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/health"
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"status\": \"ok\",\n  \"services\": {\n    \"redis\": \"connected\",\n    \"postgres\": \"connected\"\n  },\n  \"uptime\": 12345.6,\n  \"version\": \"1.0.0\"\n}"
            },
            {
              "name": "503 Service Unavailable — Degraded",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/health"
              },
              "status": "Service Unavailable",
              "code": 503,
              "header": [
                { "key": "Content-Type", "value": "application/json" },
                { "key": "Retry-After", "value": "5" }
              ],
              "body": "{\n  \"status\": \"degraded\",\n  \"services\": {\n    \"redis\": \"disconnected\",\n    \"postgres\": \"connected\"\n  }\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Events",
      "description": "Live SSE feed and historical event queries. Stream events are UnifiedEvent v1 objects validated against docs/contracts/unified-event.v1.schema.json.",
      "item": [
        {
          "name": "Get Live Event Stream (SSE)",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/streams/{{stream_id}}/events",
            "header": [
              { "key": "Accept", "value": "text/event-stream" },
              { "key": "Cache-Control", "value": "no-cache" }
            ],
            "description": "Server-Sent Events (SSE) stream for the given stream ID. Emits UnifiedEvent JSON objects as they are processed by the normalizer. Each event is formatted as:\n\n  data: {<UnifiedEvent JSON>}\\n\\n\n\nThe connection stays open until the client disconnects or the stream ends. Use the Last-Event-ID header to resume from a specific seqNo after reconnection."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// SSE streams do not return a single response body in Postman.",
                  "// This test validates the initial response headers only.",
                  "pm.test('Status is 200 OK', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Content-Type is text/event-stream', function () {",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/event-stream');",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — SSE stream open",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/streams/{{stream_id}}/events",
                "header": [
                  { "key": "Accept", "value": "text/event-stream" }
                ]
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "text/event-stream; charset=utf-8" },
                { "key": "Cache-Control", "value": "no-cache" },
                { "key": "Connection", "value": "keep-alive" },
                { "key": "X-Accel-Buffering", "value": "no" }
              ],
              "body": "data: {\"eventId\":\"a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2\",\"eventType\":\"CHAT\",\"streamId\":\"7123456789\",\"sessionId\":\"550e8400-e29b-41d4-a716-446655440001\",\"seqNo\":1,\"timestamp\":\"2024-06-01T12:00:00.000Z\",\"source\":\"live\",\"schemaVersion\":\"1\",\"user\":{\"userId\":\"1001\",\"uniqueId\":\"testuser1\",\"nickname\":\"Test User 1\",\"followRole\":0,\"userBadges\":[]},\"payload\":{\"message\":\"Hello stream!\",\"emotes\":[],\"language\":\"en\"}}\n\n"
            }
          ]
        },
        {
          "name": "Get Session Events (Historical)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/sessions/{{session_id}}/events?limit=50&cursor=",
              "host": ["{{base_url}}"],
              "path": ["sessions", "{{session_id}}", "events"],
              "query": [
                {
                  "key": "limit",
                  "value": "50",
                  "description": "Maximum number of events to return (default: 50, max: 500)"
                },
                {
                  "key": "cursor",
                  "value": "",
                  "description": "Pagination cursor (seqNo of the last event received). Omit for first page.",
                  "disabled": true
                },
                {
                  "key": "eventType",
                  "value": "CHAT",
                  "description": "Filter by event type. Repeat for multiple types.",
                  "disabled": true
                }
              ]
            },
            "description": "Retrieves historical events for the given session ID from Postgres. Supports pagination via cursor (seqNo). Results are ordered by seqNo ascending."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200 OK', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has events array', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('events');",
                  "    pm.expect(json.events).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Response has pagination fields', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('total');",
                  "    pm.expect(json).to.have.property('nextCursor');",
                  "});",
                  "",
                  "pm.test('Each event has required UnifiedEvent fields', function () {",
                  "    const json = pm.response.json();",
                  "    if (json.events.length > 0) {",
                  "        const event = json.events[0];",
                  "        pm.expect(event).to.have.all.keys(['eventId', 'eventType', 'streamId', 'sessionId', 'seqNo', 'timestamp', 'source', 'schemaVersion', 'user', 'payload']);",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — Events page",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/sessions/{{session_id}}/events?limit=2"
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"events\": [\n    {\n      \"eventId\": \"a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2\",\n      \"eventType\": \"CHAT\",\n      \"streamId\": \"7123456789\",\n      \"sessionId\": \"550e8400-e29b-41d4-a716-446655440001\",\n      \"seqNo\": 1,\n      \"timestamp\": \"2024-06-01T12:00:00.000Z\",\n      \"source\": \"live\",\n      \"schemaVersion\": \"1\",\n      \"user\": { \"userId\": \"1001\", \"uniqueId\": \"testuser1\", \"nickname\": \"Test User 1\", \"followRole\": 0, \"userBadges\": [] },\n      \"payload\": { \"message\": \"Hello stream!\", \"emotes\": [], \"language\": \"en\" }\n    },\n    {\n      \"eventId\": \"b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3\",\n      \"eventType\": \"GIFT\",\n      \"streamId\": \"7123456789\",\n      \"sessionId\": \"550e8400-e29b-41d4-a716-446655440002\",\n      \"seqNo\": 2,\n      \"timestamp\": \"2024-06-01T12:01:00.000Z\",\n      \"source\": \"live\",\n      \"schemaVersion\": \"1\",\n      \"user\": { \"userId\": \"1002\", \"uniqueId\": \"testuser2\", \"nickname\": \"Test User 2\", \"followRole\": 0, \"userBadges\": [] },\n      \"payload\": { \"giftId\": 5655, \"giftName\": \"Rose\", \"giftCount\": 10, \"coins\": 10, \"diamondCount\": 1, \"streakActive\": false, \"streakEnd\": true, \"giftImageUrl\": \"https://example.com/rose.png\", \"isGiftStreak\": true }\n    }\n  ],\n  \"total\": 13,\n  \"nextCursor\": 2\n}"
            },
            {
              "name": "404 Not Found — Session does not exist",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/sessions/00000000-0000-0000-0000-000000000000/events"
              },
              "status": "Not Found",
              "code": 404,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"error\": \"Session not found\",\n  \"sessionId\": \"00000000-0000-0000-0000-000000000000\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Sessions",
      "description": "Session management and replay controls.",
      "item": [
        {
          "name": "Trigger Session Replay",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/sessions/{{session_id}}/replay",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"speed\": 1.0,\n  \"startSeqNo\": 1\n}",
              "options": {
                "raw": { "language": "json" }
              }
            },
            "description": "Triggers a replay of all events in the session, emitting them to the SSE stream in seqNo order. Clients subscribed to `GET /streams/:id/events` will receive events with `source: \"replay\"`.\n\nBody fields:\n- `speed` (optional): Playback multiplier (1.0 = real-time, 0 = as-fast-as-possible, default: 0)\n- `startSeqNo` (optional): Resume from this seqNo (default: 1)"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 202 Accepted', function () {",
                  "    pm.response.to.have.status(202);",
                  "});",
                  "",
                  "pm.test('Response has replayId', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('replayId');",
                  "    pm.expect(json).to.have.property('sessionId');",
                  "    pm.expect(json.sessionId).to.equal(pm.collectionVariables.get('session_id'));",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "202 Accepted — Replay started",
              "originalRequest": {
                "method": "POST",
                "url": "{{base_url}}/sessions/{{session_id}}/replay",
                "body": {
                  "mode": "raw",
                  "raw": "{\"speed\": 0}"
                }
              },
              "status": "Accepted",
              "code": 202,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"replayId\": \"rep_550e8400-e29b-41d4-a716-446655440001\",\n  \"sessionId\": \"550e8400-e29b-41d4-a716-446655440001\",\n  \"status\": \"started\",\n  \"eventCount\": 13,\n  \"startSeqNo\": 1\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Rules",
      "description": "CRUD operations for the rule engine. Rules define conditions on UnifiedEvents and actions (overlay, webhook, log) to trigger when conditions are met.",
      "item": [
        {
          "name": "List Rules",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/rules?active=true",
              "host": ["{{base_url}}"],
              "path": ["rules"],
              "query": [
                {
                  "key": "active",
                  "value": "true",
                  "description": "Filter by active/inactive rules",
                  "disabled": true
                }
              ]
            },
            "description": "Returns all rules configured for the authenticated user/session. Each rule includes its conditions array and actions array."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200 OK', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — Rules list",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/rules"
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "[\n  {\n    \"id\": \"550e8400-0000-0000-0000-000000000001\",\n    \"name\": \"Gift ≥ 100 coins alert\",\n    \"active\": true,\n    \"priority\": 10,\n    \"conditions\": [\n      { \"field\": \"eventType\", \"operator\": \"eq\", \"value\": \"GIFT\" },\n      { \"field\": \"payload.coins\", \"operator\": \"gte\", \"value\": 100 }\n    ],\n    \"actions\": [\n      {\n        \"type\": \"overlay\",\n        \"template\": \"{displayName} just sent {giftCount}x {giftName}!\",\n        \"duration\": 5000\n      }\n    ],\n    \"createdAt\": \"2024-06-01T10:00:00.000Z\"\n  }\n]"
            }
          ]
        },
        {
          "name": "Create Rule",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/rules",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"New follower welcome\",\n  \"active\": true,\n  \"priority\": 5,\n  \"conditions\": [\n    { \"field\": \"eventType\", \"operator\": \"eq\", \"value\": \"FOLLOW\" }\n  ],\n  \"actions\": [\n    {\n      \"type\": \"overlay\",\n      \"template\": \"Welcome {displayName}! Thanks for following!\",\n      \"duration\": 3000\n    }\n  ]\n}",
              "options": {
                "raw": { "language": "json" }
              }
            },
            "description": "Creates a new rule. Returns the created rule with its generated `id`. The returned `id` is automatically stored in the `rule_id` collection variable for use in subsequent requests."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 201 Created', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has rule id', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('id');",
                  "    pm.collectionVariables.set('rule_id', json.id);",
                  "});",
                  "",
                  "pm.test('Rule has required fields', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('name');",
                  "    pm.expect(json).to.have.property('conditions');",
                  "    pm.expect(json).to.have.property('actions');",
                  "    pm.expect(json.conditions).to.be.an('array').with.length.above(0);",
                  "    pm.expect(json.actions).to.be.an('array').with.length.above(0);",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "201 Created — Rule created",
              "originalRequest": {
                "method": "POST",
                "url": "{{base_url}}/rules",
                "body": {
                  "mode": "raw",
                  "raw": "{\"name\":\"New follower welcome\",\"active\":true,\"priority\":5,\"conditions\":[{\"field\":\"eventType\",\"operator\":\"eq\",\"value\":\"FOLLOW\"}],\"actions\":[{\"type\":\"overlay\",\"template\":\"Welcome {displayName}!\",\"duration\":3000}]}"
                }
              },
              "status": "Created",
              "code": 201,
              "header": [
                { "key": "Content-Type", "value": "application/json" },
                { "key": "Location", "value": "/rules/550e8400-0000-0000-0000-000000000002" }
              ],
              "body": "{\n  \"id\": \"550e8400-0000-0000-0000-000000000002\",\n  \"name\": \"New follower welcome\",\n  \"active\": true,\n  \"priority\": 5,\n  \"conditions\": [\n    { \"field\": \"eventType\", \"operator\": \"eq\", \"value\": \"FOLLOW\" }\n  ],\n  \"actions\": [\n    {\n      \"type\": \"overlay\",\n      \"template\": \"Welcome {displayName}! Thanks for following!\",\n      \"duration\": 3000\n    }\n  ],\n  \"createdAt\": \"2024-06-01T12:00:00.000Z\"\n}"
            },
            {
              "name": "422 Unprocessable Entity — Invalid rule body",
              "originalRequest": {
                "method": "POST",
                "url": "{{base_url}}/rules",
                "body": {
                  "mode": "raw",
                  "raw": "{\"name\":\"Missing conditions\"}"
                }
              },
              "status": "Unprocessable Entity",
              "code": 422,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"error\": \"Validation failed\",\n  \"details\": [\n    { \"field\": \"conditions\", \"message\": \"conditions is required\" },\n    { \"field\": \"actions\", \"message\": \"actions is required\" }\n  ]\n}"
            }
          ]
        },
        {
          "name": "Update Rule",
          "request": {
            "method": "PUT",
            "url": "{{base_url}}/rules/{{rule_id}}",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"New follower welcome (updated)\",\n  \"active\": true,\n  \"priority\": 5,\n  \"conditions\": [\n    { \"field\": \"eventType\", \"operator\": \"eq\", \"value\": \"FOLLOW\" }\n  ],\n  \"actions\": [\n    {\n      \"type\": \"overlay\",\n      \"template\": \"Welcome {displayName}! You're follower #{totalFollowers}!\",\n      \"duration\": 4000\n    }\n  ]\n}",
              "options": {
                "raw": { "language": "json" }
              }
            },
            "description": "Replaces all fields of the rule identified by `rule_id`. Uses the `rule_id` collection variable populated by 'Create Rule'. Returns the updated rule."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200 OK', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Rule id is unchanged', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.id).to.equal(pm.collectionVariables.get('rule_id'));",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — Rule updated",
              "originalRequest": {
                "method": "PUT",
                "url": "{{base_url}}/rules/{{rule_id}}"
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"id\": \"550e8400-0000-0000-0000-000000000002\",\n  \"name\": \"New follower welcome (updated)\",\n  \"active\": true,\n  \"priority\": 5,\n  \"conditions\": [{\"field\":\"eventType\",\"operator\":\"eq\",\"value\":\"FOLLOW\"}],\n  \"actions\": [{\"type\":\"overlay\",\"template\":\"Welcome {displayName}! You're follower #{totalFollowers}!\",\"duration\":4000}],\n  \"updatedAt\": \"2024-06-01T13:00:00.000Z\"\n}"
            },
            {
              "name": "404 Not Found",
              "originalRequest": {
                "method": "PUT",
                "url": "{{base_url}}/rules/00000000-0000-0000-0000-000000000000"
              },
              "status": "Not Found",
              "code": 404,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"error\": \"Rule not found\"\n}"
            }
          ]
        },
        {
          "name": "Delete Rule",
          "request": {
            "method": "DELETE",
            "url": "{{base_url}}/rules/{{rule_id}}",
            "description": "Deletes the rule identified by `rule_id`. Returns 204 No Content on success. This request is last in the Rules folder to allow Create → Update → Delete sequencing in a collection run."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 204 No Content', function () {",
                  "    pm.response.to.have.status(204);",
                  "});",
                  "",
                  "pm.test('Response body is empty', function () {",
                  "    pm.expect(pm.response.text()).to.equal('');",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "204 No Content — Rule deleted",
              "originalRequest": {
                "method": "DELETE",
                "url": "{{base_url}}/rules/{{rule_id}}"
              },
              "status": "No Content",
              "code": 204,
              "header": [],
              "body": ""
            }
          ]
        }
      ]
    },
    {
      "name": "Storage",
      "description": "Direct storage queries for streams and users. These endpoints expose data from the Postgres `streams` and `users` tables.",
      "item": [
        {
          "name": "Get Stream Info",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/streams/{{stream_id}}",
            "description": "Returns metadata for the given stream ID including status, session count, and start time."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200 OK or 404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('Response has streamId', function () {",
                  "        const json = pm.response.json();",
                  "        pm.expect(json).to.have.property('streamId');",
                  "        pm.expect(json).to.have.property('status');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — Stream found",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/streams/{{stream_id}}"
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"streamId\": \"7123456789\",\n  \"platform\": \"tiktok\",\n  \"status\": \"active\",\n  \"startedAt\": \"2024-06-01T11:55:00.000Z\",\n  \"sessionCount\": 1\n}"
            }
          ]
        },
        {
          "name": "List Sessions for Stream",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/streams/{{stream_id}}/sessions?limit=20",
              "host": ["{{base_url}}"],
              "path": ["streams", "{{stream_id}}", "sessions"],
              "query": [
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Maximum number of sessions to return"
                }
              ]
            },
            "description": "Lists all sessions associated with the given stream ID, ordered by start time descending."
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status is 200 OK', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has sessions array', function () {",
                  "    const json = pm.response.json();",
                  "    pm.expect(json).to.have.property('sessions');",
                  "    pm.expect(json.sessions).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "response": [
            {
              "name": "200 OK — Sessions list",
              "originalRequest": {
                "method": "GET",
                "url": "{{base_url}}/streams/{{stream_id}}/sessions"
              },
              "status": "OK",
              "code": 200,
              "header": [
                { "key": "Content-Type", "value": "application/json" }
              ],
              "body": "{\n  \"sessions\": [\n    {\n      \"sessionId\": \"550e8400-e29b-41d4-a716-446655440001\",\n      \"streamId\": \"7123456789\",\n      \"startedAt\": \"2024-06-01T12:00:00.000Z\",\n      \"endedAt\": null,\n      \"eventCount\": 13,\n      \"status\": \"active\"\n    }\n  ],\n  \"total\": 1\n}"
            }
          ]
        }
      ]
    }
  ]
}
